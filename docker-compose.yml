version: '3.7'
services:
  signaling:
    build:
      context: ./signaling
    hostname: signaling
    container_name: signaling
    volumes: 
      - ./data:/opt/data
      - ./signaling:/opt/signaling
    ports:
      - "9449:9449"
  webrtc-turn-server:
    build:
      context: ./webrtc-turn-server
    hostname: webrtc-turn-server
    container_name: webrtc-turn-server
    tty: true
    ports:
      - "3479:3479"
      - "3479:3479/udp"
      - "5349:5349"
      - "5349:5349/udp"
      - "49160-49200:49160-49200/udp"
  webrtc:
    build: 
      context: ./webrtc-sample
    hostname: webrtc
    container_name: webrtc
    privileged: true
    devices:
      - /dev
    ports:
      - "3478:3478"
      - "3478:3478/udp"
      - "3033:3033"
      # 性能の低い端末だと、この個数のポートフォワーディングできない
      # - "59000-65000:59000-65000/udp"
    tty: true
    depends_on:
      - "signaling"
    command: >
      /opt/gst-webrtc-sample/build/gst-webrtc-sample
